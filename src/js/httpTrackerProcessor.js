let eventTracker=function(){let e=[],t=new Map,n=new Map,l=!1,s=new TextDecoder("UTF-8"),r=null,a=null,i=null,d=null,o="",c="",u=null,v,f,b,p=!1,h,m,w=new Map,E=new Map,g="",y=!0,L="",k=null,T="",q=!1,C="",A=["frameAncestors","frameId","parentFrameId","tabId","timeStamp","type","callerName","requestIdEnhanced","requestId"],$="<tr><td class='web_event_detail_header_key'>",N="</td><td class='web_event_detail_header_value'>";async function _(t){var n,s,r,a,i,d,o,u,b,p,h,m,L,k,q,C,A,$,N,_,R,M;let O,D,P,K,B;n=t,!(y&&(s=n,D=function e(t){if(t.requestIdEnhanced.includes("fakeRequest"))return!1;if(!includeURLsList&&!f)return!0;let n=!1;return includeURLsList&&includeURLsList.length&&(n=includeURLsList.some(e=>t.url.toLowerCase().includes(e))),!n&&f&&f.length&&(n=f.some(e=>t.url.toLowerCase().includes(e))),n}(s),P=!D||(r=s,O=!1,excludeURLsList?O=excludeURLsList.some(e=>r.url.toLowerCase().includes(e.toLowerCase())):!O&&v&&(O=v.some(e=>r.url.toLowerCase().includes(e.toLowerCase()))),O),D&&!P))||(a=n,void 0===(K=E.get(a.requestId))?(K=0,E.set(a.requestId,K)):K&&(a.requestIdEnhanced=`${a.requestId}_${K}`),"onBeforeRequest"===(i=n).callerName&&(d=i,d.requestBody&&l&&w.set(d.requestIdEnhanced,d.requestBody)),"onBeforeSendHeaders"===(o=n).callerName&&I(o),"onSendHeaders"===(u=n).callerName&&I(u),function e(t){if("onBeforeRedirect"===t.callerName&&t.ip){let n=E.get(t.requestId);E.set(t.requestId,++n),x(t)}}(n),"onAuthRequired"===(b=n).callerName&&x(b),"onHeadersReceived"===(p=n).callerName&&x(p),"onResponseStarted"===(h=n).callerName&&x(h),"onCompleted"===(m=n).callerName&&x(m),"onErrorOccurred"===(L=n).callerName&&x(L),0)||(k=t,-1===e.indexOf(k.requestIdEnhanced)?(q=k,e.push(q.requestIdEnhanced),B="<div title='Click to view details' class='web_event_list_blank web_event_list_style' id='web_events_list_"+q.requestIdEnhanced+"'>"+(C=q,`<div class='web_event_list_url' id='web_event_url_${C.requestIdEnhanced}'>${C.url}</div>`)+(A=q,`<div class='web_event_list_method' id='web_event_method_${A.requestIdEnhanced}'>${A.method}</div>`)+($=q,`<div class='web_event_list_status' id='web_event_status_${$.requestIdEnhanced}'>${$.statusCode?$.statusCode:$.error?STRING_ERROR:"N/A"}</div>`)+(N=q,`<div class='web_event_list_date_time' id='web_event_time_${N.requestIdEnhanced}'>${N.timeStamp?S(N.timeStamp):"N/A"}</div>`)+(_=q,`<div class='web_event_list_cache' id='web_event_cache_${_.requestIdEnhanced}'>N/A</div>`)+"</div>",getById("urls_list").insertAdjacentHTML("beforeend",B)):(R=k,"onErrorOccurred"===R.callerName?(getById(`web_events_list_${R.requestIdEnhanced}`).classList.add("web_event_style_error"),getById(`web_event_status_${R.requestIdEnhanced}`).innerHTML=STRING_ERROR):R.statusCode&&(getById(`web_events_list_${R.requestIdEnhanced}`).classList.remove("web_event_style_error"),getById(`web_event_status_${R.requestIdEnhanced}`).innerHTML=R.statusCode),getById(`web_event_cache_${R.requestIdEnhanced}`).innerHTML=R.fromCache?R.fromCache:"N/A"),function e(t){if(T.length){let n=getById("web_event_filter_key").selectedOptions[0].innerText,l="";"CACHE"===n&&(l=t.fromCache?t.fromCache:"N/A"),"METHOD"===n&&(l=t.method),"STATUS"===n&&(l=`${t.statusCode?t.statusCode:t.error?STRING_ERROR:"N/A"}`),"URL"===n&&(l=t.url),"DATE"===n&&(l=`${t.timeStamp?S(t.timeStamp):"N/A"}`),l.toString().toLowerCase().includes(c)?getById(`web_events_list_${t.requestIdEnhanced}`).classList.remove("web_event_list_hide"):getById(`web_events_list_${t.requestIdEnhanced}`).classList.add("web_event_list_hide")}}(k),M=t,g&&M.requestIdEnhanced===g&&H())}function S(e){let t=new Date(e);return`${t.toLocaleDateString()} ${t.toLocaleTimeString()}`}function I(e){e.requestHeaders&&t.set(e.requestIdEnhanced,e)}function x(e){n.set(e.requestIdEnhanced,e)}function H(){let e=t.get(g),l=n.get(g),r=w.get(g),a=M(e,"requestDetails"),i=M(l,"responseDetails"),d=function e(t){let n="";if(t){if(t.formData)n="<tr><td colspan=2 class='web_event_detail_cookie'>Body (form fields data)</td></tr>",Object.entries(t.formData).forEach(([e,t])=>{n+=O(e,t)});else if(t.raw)for(let l of(n="<tr><td colspan=2 class='web_event_detail_cookie'>Body (raw form data)</td></tr>",t.raw)){let r=new DataView(l.bytes);n+=`<tr style='white-space: pre-wrap; word-break: break-all;'><td colspan=2>${D(s.decode(r))}</td></tr>`}}return n}(r);getById("web_event_details_selected_request").style.borderRight="1px solid",getById("web_event_details_selected_response").style.borderRight="1px solid",getById("web_event_details_selected_request").style.borderLeft="1px solid",getById("web_event_details_selected_response").style.borderLeft="1px solid",getById("web_event_details_selected_request").style.borderBottom="1px solid",getById("web_event_details_selected_response").style.borderBottom="1px solid",getById("request_headers_details").innerHTML=a+d,getById("response_headers_details").innerHTML=i,getById("web_details_selected_container").style="visibility: visible;"}function R(){cookiesList=httpTracker.browser.cookies.getAll({domain:getById("delete_cookies").value},P)}function M(e,t){let n="",l="";return e?(n="<tr><td colspan=2 class='web_event_detail_cookie'>Headers</td></tr>",Object.entries(e).forEach(([e,t])=>{if("responseHeaders"!==e&&"requestHeaders"!==e){if(!A.includes(e)&&null!=t){if("object"!=typeof t)n+=O(e,t);else{let s="";Object.entries(t).forEach(([e,t])=>{s+=`${e}: ${JSON.stringify(t)}, `}),n+=O(e,s=s.substring(0,s.length-2))}}}else{var r;let a,i,d,o;l=(r=sortJsonByProperty(t,"name"),a="",i="<tr><td colspan=2 class='web_event_detail_cookie'>Cookies (sorted by symbols, Aa-Zz)</td></tr>",d="",o=new Map,r.forEach(e=>{var t,n,l,s;let r,c,u,v,f;e.name===DELIMITER_REQUEST_COOKIE_KEY_NAME?d+=(t=e.value,n=DELIMITER_REQUEST_COOKIE,r=t.split(n).sort(sortArray),c="",u=new Map,r.forEach(e=>{if(e){let t=e.indexOf("=");t>-1&&u.set(e.substring(0,t),e.substring(t+1))}}),u.forEach((e,t)=>{c+=`${$}${D(t)}${N}${D(e)}</td></tr>`}),c):e.name.toLowerCase()===DELIMITER_RESPONSE_COOKIE_KEY_NAME?m?(i="<tr><td colspan=2 class='web_event_detail_cookie'>Cookies (optimized)</td></tr>",function e(t,n,l){t.split(n).forEach(e=>{if(e){let t="",n=K(e);t=n.cookieName&&n.domain&&n.path?`${n.cookieName}:${n.domain}:${n.path}`:n.cookieName&&n.domain?`${n.cookieName}:${n.domain}`:`${n.cookieName}`,l.set(t,n)}})}(e.value,DELIMITER_RESPONSE_COOKIE,o)):(i="<tr><td colspan=2 class='web_event_detail_cookie'>Cookies (unoptimized)</td></tr>",d+=(l=e.value,s=DELIMITER_RESPONSE_COOKIE,v=l.split(s),f="",v.forEach(e=>{if(e){let t=K(e);f+=`${$}${D(t.cookieName)}${N}${D(t.cookieValue)}</td></tr>`}}),f)):a+=`${$}${D(e.name)}${N}${D(e.value)}</td></tr>`}),m&&sortMapByKey(o).forEach((e,t)=>{d+=`${$}${D(t.split(":",1))}${N}${D(e.cookieValue)}</td></tr>`}),d&&(d=i+d),a+d)}})):n="responseDetails"===t?"<tr><td class='web_event_style_error' style='text-align: center;'>Response not available</td></tr>":"<tr><td class='web_event_style_error' style='text-align: center;'>Request not available</td></tr>",n+l}function O(e,t){var n;let l;return n=e,l=!1,p&&(h&&(l=h.some(e=>n.toLowerCase().includes(e))),!l&&b&&(l=b.some(e=>n.toLowerCase().includes(e)))),l&&(t=t.toString().trim()).length&&(t=t.charAt(0)+"*****"+t.charAt(t.length-1)),`${$}${D(e)}${N}${D(t)}`}function D(e){if(L.length){let t=RegExp(L,"gi");return e.toString().replace(t,e=>`<mark>${e}</mark>`)}return e}function P(e){let t=[];for(let n of e){let l=`${n.secure?"https:":"http:"}//${n.domain}${n.path}`,s=httpTracker.browser.cookies.remove({url:l,name:n.name,storeId:n.storeId});t.push(s)}Promise.all(t).then(e=>{})}function K(e){let t=e.indexOf("="),n={};return t>-1&&(n.cookieName=e.substring(0,t),n.cookieValue=e.substring(t+1),n.cookieValue&&stringToArray(n.cookieValue,";").forEach(e=>{if(e){let t=e.trim().split("=");("domain"===t[0].toLowerCase()||"path"===t[0].toLowerCase())&&(n[t[0].toLowerCase()]=t[1]),"domain"===t[0].toLowerCase()&&(C=t[1])}})),n}function B(){if(0==T.length)!function e(){let t=getById("urls_list").getElementsByClassName("web_event_list_blank web_event_list_hide");for(;t.length;)t[0].classList.remove("web_event_list_hide")}();else{let e=Array.prototype.slice.call(V());for(let t of e){let n=t.childNodes[o].innerHTML.toLowerCase();if(q){let l=0;T.forEach(e=>{-1!==l&&-1!==(l=n.indexOf(e,l))&&(l+=e.length)}),-1===l?t.classList.add("web_event_list_hide"):t.classList.remove("web_event_list_hide")}else T.some(e=>n.includes(e))?t.classList.remove("web_event_list_hide"):t.classList.add("web_event_list_hide")}}}function U(e){let l=e.id.substring(16,e.id.length);E.delete(l),t.delete(l),n.delete(l),w.delete(l),e.remove(),l===g&&(getById("delete_selected_web_event").disabled=!0,getById("response_headers_details").innerHTML="",getById("request_headers_details").innerHTML="",getById("web_details_selected_container").style="visibility: hidden;",g=null,selectedEvent=null)}function G(){let e=V();return Array.prototype.filter.call(e,function(e){return!e.classList.contains("web_event_list_hide")})}function V(){return getById("urls_list").getElementsByClassName("web_event_list_blank")}function Y(e){k&&clearTimeout(k),k=setTimeout(function(){L=e.target.value.trim(),H()},500)}function z(){let e=[],t=getByClassNames("single_header_container");Array.prototype.filter.call(t,function(t){if(index=t.id.substring(15),headerName=t.querySelector(".header_input_name").value.trim()){if(FORBIDDEN_HEADERS.some(e=>headerName.toLowerCase()===e.toLowerCase())||FORBIDDEN_HEADERS_PATTERN.some(e=>headerName.toLowerCase().startsWith(e.toLowerCase())))t.querySelector(".add_header_name").style.color="red";else if(t.querySelector(".add_header_name").style.color="",t.querySelector(".header_input_apply").checked){let n={};n.name=headerName,n.value=t.querySelector(".header_input_value").value,n.url=t.querySelector(".header_input_url").value.trim(),e.push(n)}}}),setRequestHeadersList(e),e.length||t.length?getById("add_modify_headers_banner").innerHTML=`Add/Modify request headers: ${e.length}`:getById("add_modify_headers_banner").innerHTML="Add/Modify request headers:"}function F(e){"0"===e.target.id.substring(21)?(getById("header_name_0").value="",getById("header_value_0").value="",getById("header_url_0").value=""):getById("header_details_"+e.target.id.substring(21)).remove(),z()}function X(e){let t=getByClassNames("single_header_container"),n=t.length;var l=document.createElement("div");l.id="header_details_"+n,l.classList="single_header_container";var s=document.createElement("div");s.classList="add_header_url";var r=document.createTextNode("URL "),a=document.createElement("input");a.setAttribute("type","text"),a.id="header_url_"+n,a.classList="header_input_url",s.append(r),s.append(a);var i=document.createElement("div");i.classList="add_header_value";var d=document.createTextNode("Value "),o=document.createElement("input");o.setAttribute("type","text"),o.id="header_value_"+n,o.classList="header_input_value",i.append(d),i.append(o);var c=document.createElement("div");c.classList="add_header_name";var u=document.createTextNode("Name "),v=document.createElement("input");v.setAttribute("type","text"),v.id="header_name_"+n,v.classList="header_input_name",c.append(u),c.append(v);var f=document.createElement("div");f.classList="add_header_apply";var b=document.createElement("input");b.setAttribute("type","checkbox"),b.id="header_apply_"+n,b.classList="header_input_apply";var p=document.createElement("label");p.htmlFor="header_apply_"+n,p.innerHTML="Apply",f.append(b,p);var h=document.createElement("div");h.style="width: 12%;float: left;text-align: right;";var m=document.createElement("div");m.style="display: flex;";var w=document.createElement("input");w.setAttribute("type","button"),w.value="-",w.id="header_button_remove_"+n,w.onclick=F;var E=document.createElement("div");E.style="margin-right: 5px;float: left;flex-grow: 1;",E.append(w);var g=document.createElement("input");g.setAttribute("type","button"),g.value="+",g.style="visibility: hidden;";var y=document.createElement("div");y.append(g),m.append(E,y),h.append(m),l.append(c,i,s,f,h),t[n-1].after(l)}function j(){y?(y=!1,getById("toggle_track_web_events").innerHTML="Resume tracker"):(y=!0,getById("toggle_track_web_events").innerHTML="Pause tracker")}function W(){l=getById("include_form_data").checked}function Z(){m=getById("optimize_response_cookies").checked,H()}function J(){p=getById("enable_mask_patterns").checked,H()}function Q(e){d&&clearTimeout(d),d=setTimeout(function(){h=stringToArray(e.target.value),H()},500)}function ee(){w.clear(),t.clear(),n.clear(),e.length=0,getById("web_event_details_selected_request").style.border="none",getById("web_event_details_selected_response").style.border="none",getById("response_headers_details").innerHTML="",getById("request_headers_details").innerHTML="",getById("urls_list").innerHTML="",getById("web_details_selected_container").style="visibility: hidden;"}function et(){let e=G();if(e)for(node of e)U(node);en()}function en(){c=getById("filter_web_events").value="",T="",B(),ec()}function el(e){if(e.target&&e.target.classList.contains("web_event_list_container")){let t;!function e(t,n){if(40==n){let l=t?t.nextElementSibling:t;for(;l;)if(l.classList.contains("web_event_list_hide"))l=l.nextElementSibling;else{eu(l.id);break}}else if(38==n){let s=t?t.previousElementSibling:t;for(;s;)if(s.classList.contains("web_event_list_hide"))s=s.previousElementSibling;else{eu(s.id);break}}}(ev(),e.keyCode)}}function es(){let e=ev();e&&(U(e),getById("delete_selected_web_event").disabled=!0,e=null)}function er(e){e.target&&e.target.parentElement.classList.contains("web_event_list_blank")&&(eu(e.target.parentElement.id),getById("delete_selected_web_event").disabled=!1,getById("delete_selected_web_event").classList.remove("web_event_list_filtered"))}function ea(e){u&&clearTimeout(u),u=setTimeout(function(){o=getById("web_event_filter_key").selectedOptions[0].value,c=getById("filter_web_events").value.toLowerCase().trim(),q=!1,T="",c&&(c.length<3||c.includes(DELIMITER_OR)&&c.includes(DELIMITER_AND)||(c.includes(DELIMITER_AND)?(T=stringToArray(c,DELIMITER_AND),T=filterWithLength(T,2)):(T=stringToArray(c,DELIMITER_OR),T=filterWithLength(T,2),q=!1))),B(),ec()},500)}function ei(e){r&&clearTimeout(r),r=setTimeout(function(){excludeURLsList=stringToArray(e.target.value)},500)}function ed(e){a&&clearTimeout(a),a=setTimeout(function(){blockURLSList=stringToArray(e.target.value)},500)}async function e8(e){i&&clearTimeout(i),i=setTimeout(function(){includeURLsList=stringToArray(e.target.value)},500)}function eo(){if(f&&f.length){let e=getById("info_include");e.innerHTML="&#9432;",e.title=`Patterns extended from preferences: ${f}`,e.style.color="red"}else{let t=getById("info_include");t.innerHTML="",t.title=""}if(v&&v.length){let n=getById("info_exclude");n.innerHTML="&#9432;",n.title=`Patterns extended from preferences: ${v}`,n.style.color="red"}else{let l=getById("info_exclude");l.innerHTML="",l.title=""}if(b&&b.length){let s=getById("info_mask");s.innerHTML="&#9432;",s.title=`Patterns extended from preferences: ${b}`,s.style.color="red"}else{let r=getById("info_mask");r.innerHTML="",r.title=""}}function ec(){c?getById("clear_filter_web_events").disabled=!1:getById("clear_filter_web_events").disabled=!0,ev()||(getById("delete_selected_web_event").disabled=!0),function e(){if(c&&c.length>2){let t=G();t&&t.length>0?getById("delete_all_filtered_web_events").disabled=!1:getById("delete_all_filtered_web_events").disabled=!0}else getById("delete_all_filtered_web_events").disabled=!0}()}function eu(e){let t;getById("web_event_detail_request_head").style.removeProperty("display"),getById("web_event_detail_response_head").style.removeProperty("display"),(t=ev())&&t.classList.remove("web_event_list_selected");getById(e).classList.add("web_event_list_selected"),g=e.substring(16),H()}function ev(){return getByClassNames("web_event_list_selected")[0]}return document.addEventListener("DOMContentLoaded",function(){document.title=getManifestDetails().title,getById("track_urls_pattern").oninput=e8,getById("exclude_urls_pattern").oninput=ei,getById("block_urls_pattern").oninput=ed,getById("mask_patterns_list").oninput=Q,getById("enable_mask_patterns").onchange=J,getById("include_form_data").onchange=W,getById("optimize_response_cookies").onchange=Z,getById("filter_web_events").oninput=ea,getById("web_event_filter_key").oninput=ea,getById("clear_filter_web_events").onclick=en,getById("delete_all_filtered_web_events").onclick=et,getById("delete_selected_web_event").onclick=es,getById("delete_all_web_events").onclick=ee,getById("urls_list").onclick=er,getById("urls_list").onkeydown=el,getById("toggle_track_web_events").onclick=j,getById("header_button_remove_0").onclick=F,getById("header_button_add_0").onclick=X,getById("add_modify_headers").oninput=z,getById("find_in_details_pattern").oninput=Y,getById("delete_cookies_button").onclick=R,getById("preferences").addEventListener("click",function(){openAddonOptions()}),c=getById("filter_web_events").value,l=getById("include_form_data").checked,m=getById("optimize_response_cookies").checked,includeURLsList=stringToArray(getById("track_urls_pattern").value),excludeURLsList=stringToArray(getById("exclude_urls_pattern").value),h=stringToArray(getById("mask_patterns_list").value),p=getById("enable_mask_patterns").checked,blockURLSList=stringToArray(getById("block_urls_pattern").value),ec(),B(),eo()}),httpTracker.browser.storage.onChanged.addListener(function e(t,n){for(var l in t)l===httpTracker.STORAGE_KEY_EXCLUDE_PATTERN?v=t[l].newValue:l===httpTracker.STORAGE_KEY_INCLUDE_PATTERN?f=t[l].newValue:l===httpTracker.STORAGE_KEY_MASK_PATTERN&&(b=t[l].newValue);eo(),H()}),httpTracker.browser.storage.sync.get([httpTracker.STORAGE_KEY_INCLUDE_PATTERN,httpTracker.STORAGE_KEY_EXCLUDE_PATTERN,httpTracker.STORAGE_KEY_MASK_PATTERN],function e(t){v=getPropertyFromStorage(t,httpTracker.STORAGE_KEY_EXCLUDE_PATTERN),b=getPropertyFromStorage(t,httpTracker.STORAGE_KEY_MASK_PATTERN),f=getPropertyFromStorage(t,httpTracker.STORAGE_KEY_INCLUDE_PATTERN)}),{logRequestDetails:_}}();